#pragma once

#include <array>
#include <cstdint>
#include <functional>
#include <string>

class Bus;

enum Flag {
    Z = 0,
    N,
    H,
    C
};

class CPULR35902 {
public:
    CPULR35902(Bus* bus);
    ~CPULR35902();
    void reset(); 

    void fetchDecodeExecute();

private:
    void setFlags(int Z, int N, int H, int C);
    bool getFlag(Flag flag);
    std::string toHexString(int value);
    void initOpcodeHandlers();

    union Register {
        uint16_t w;
	    struct {
            uint8_t right;
	        uint8_t left;
	    };
    };
    Register AF;
    Register BC;
    Register DE;
    Register HL;
    Register SP;
    Register PC;

    unsigned long long T = 0;
    bool halt = false;
    bool stop = false; 
    
    Bus* bus;

    std::array<std::function<void()>, 256> opcodeHandler;
    std::array<std::function<void()>, 256> prefixHandler;

    void OP_00();
    void OP_01();
    void OP_02();
    void OP_03();
    void OP_04();
    void OP_05();
    void OP_06();
    void OP_07();
    void OP_08();
    void OP_09();
    void OP_0A();
    void OP_0B();
    void OP_0C();
    void OP_0D();
    void OP_0E();
    void OP_0F();
    void OP_10();
    void OP_11();
    void OP_12();
    void OP_13();
    void OP_14();
    void OP_15();
    void OP_16();
    void OP_17();
    void OP_18();
    void OP_19();
    void OP_1A();
    void OP_1B();
    void OP_1C();
    void OP_1D();
    void OP_1E();
    void OP_1F();
    void OP_20();
    void OP_21();
    void OP_22();
    void OP_23();
    void OP_24();
    void OP_25();
    void OP_26();
    void OP_27();
    void OP_28();
    void OP_29();
    void OP_2A();
    void OP_2B();
    void OP_2C();
    void OP_2D();
    void OP_2E();
    void OP_2F();
    void OP_30();
    void OP_31();
    void OP_32();
    void OP_33();
    void OP_34();
    void OP_35();
    void OP_36();
    void OP_37();
    void OP_38();
    void OP_39();
    void OP_3A();
    void OP_3B();
    void OP_3C();
    void OP_3D();
    void OP_3E();
    void OP_3F();
    void OP_40();
    void OP_41();
    void OP_42();
    void OP_43();
    void OP_44();
    void OP_45();
    void OP_46();
    void OP_47();
    void OP_48();
    void OP_49();
    void OP_4A();
    void OP_4B();
    void OP_4C();
    void OP_4D();
    void OP_4E();
    void OP_4F();
    void OP_50();
    void OP_51();
    void OP_52();
    void OP_53();
    void OP_54();
    void OP_55();
    void OP_56();
    void OP_57();
    void OP_58();
    void OP_59();
    void OP_5A();
    void OP_5B();
    void OP_5C();
    void OP_5D();
    void OP_5E();
    void OP_5F();
    void OP_60();
    void OP_61();
    void OP_62();
    void OP_63();
    void OP_64();
    void OP_65();
    void OP_66();
    void OP_67();
    void OP_68();
    void OP_69();
    void OP_6A();
    void OP_6B();
    void OP_6C();
    void OP_6D();
    void OP_6E();
    void OP_6F();
    void OP_70();
    void OP_71();
    void OP_72();
    void OP_73();
    void OP_74();
    void OP_75();
    void OP_76();
    void OP_77();
    void OP_78();
    void OP_79();
    void OP_7A();
    void OP_7B();
    void OP_7C();
    void OP_7D();
    void OP_7E();
    void OP_7F();
    void OP_80();
    void OP_81();
    void OP_82();
    void OP_83();
    void OP_84();
    void OP_85();
    void OP_86();
    void OP_87();
    void OP_88();
    void OP_89();
    void OP_8A();
    void OP_8B();
    void OP_8C();
    void OP_8D();
    void OP_8E();
    void OP_8F();
    void OP_90();
    void OP_91();
    void OP_92();
    void OP_93();
    void OP_94();
    void OP_95();
    void OP_96();
    void OP_97();
    void OP_98();
    void OP_99();
    void OP_9A();
    void OP_9B();
    void OP_9C();
    void OP_9D();
    void OP_9E();
    void OP_9F();
    void OP_A0();
    void OP_A1();
    void OP_A2();
    void OP_A3();
    void OP_A4();
    void OP_A5();
    void OP_A6();
    void OP_A7();
    void OP_A8();
    void OP_A9();
    void OP_AA();
    void OP_AB();
    void OP_AC();
    void OP_AD();
    void OP_AE();
    void OP_AF();
    void OP_B0();
    void OP_B1();
    void OP_B2();
    void OP_B3();
    void OP_B4();
    void OP_B5();
    void OP_B6();
    void OP_B7();
    void OP_B8();
    void OP_B9();
    void OP_BA();
    void OP_BB();
    void OP_BC();
    void OP_BD();
    void OP_BE();
    void OP_BF();
    void OP_C0();
    void OP_C1();
    void OP_C2();
    void OP_C3();
    void OP_C4();
    void OP_C5();
    void OP_C6();
    void OP_C7();
    void OP_C8();
    void OP_C9();
    void OP_CA();
    void OP_CB();
    void OP_CC();
    void OP_CD();
    void OP_CE();
    void OP_CF();
    void OP_D0();
    void OP_D1();
    void OP_D2();
    void OP_D3();
    void OP_D4();
    void OP_D5();
    void OP_D6();
    void OP_D7();
    void OP_D8();
    void OP_D9();
    void OP_DA();
    void OP_DB();
    void OP_DC();
    void OP_DD();
    void OP_DE();
    void OP_DF();
    void OP_E0();
    void OP_E1();
    void OP_E2();
    void OP_E3();
    void OP_E4();
    void OP_E5();
    void OP_E6();
    void OP_E7();
    void OP_E8();
    void OP_E9();
    void OP_EA();
    void OP_EB();
    void OP_EC();
    void OP_ED();
    void OP_EE();
    void OP_EF();
    void OP_F0();
    void OP_F1();
    void OP_F2();
    void OP_F3();
    void OP_F4();
    void OP_F5();
    void OP_F6();
    void OP_F7();
    void OP_F8();
    void OP_F9();
    void OP_FA();
    void OP_FB();
    void OP_FC();
    void OP_FD();
    void OP_FE();
    void OP_FF();
    
    void PR_00();
    void PR_01();
    void PR_02();
    void PR_03();
    void PR_04();
    void PR_05();
    void PR_06();
    void PR_07();
    void PR_08();
    void PR_09();
    void PR_0A();
    void PR_0B();
    void PR_0C();
    void PR_0D();
    void PR_0E();
    void PR_0F();
    void PR_10();
    void PR_11();
    void PR_12();
    void PR_13();
    void PR_14();
    void PR_15();
    void PR_16();
    void PR_17();
    void PR_18();
    void PR_19();
    void PR_1A();
    void PR_1B();
    void PR_1C();
    void PR_1D();
    void PR_1E();
    void PR_1F();
    void PR_20();
    void PR_21();
    void PR_22();
    void PR_23();
    void PR_24();
    void PR_25();
    void PR_26();
    void PR_27();
    void PR_28();
    void PR_29();
    void PR_2A();
    void PR_2B();
    void PR_2C();
    void PR_2D();
    void PR_2E();
    void PR_2F();
    void PR_30();
    void PR_31();
    void PR_32();
    void PR_33();
    void PR_34();
    void PR_35();
    void PR_36();
    void PR_37();
    void PR_38();
    void PR_39();
    void PR_3A();
    void PR_3B();
    void PR_3C();
    void PR_3D();
    void PR_3E();
    void PR_3F();
    void PR_40();
    void PR_41();
    void PR_42();
    void PR_43();
    void PR_44();
    void PR_45();
    void PR_46();
    void PR_47();
    void PR_48();
    void PR_49();
    void PR_4A();
    void PR_4B();
    void PR_4C();
    void PR_4D();
    void PR_4E();
    void PR_4F();
    void PR_50();
    void PR_51();
    void PR_52();
    void PR_53();
    void PR_54();
    void PR_55();
    void PR_56();
    void PR_57();
    void PR_58();
    void PR_59();
    void PR_5A();
    void PR_5B();
    void PR_5C();
    void PR_5D();
    void PR_5E();
    void PR_5F();
    void PR_60();
    void PR_61();
    void PR_62();
    void PR_63();
    void PR_64();
    void PR_65();
    void PR_66();
    void PR_67();
    void PR_68();
    void PR_69();
    void PR_6A();
    void PR_6B();
    void PR_6C();
    void PR_6D();
    void PR_6E();
    void PR_6F();
    void PR_70();
    void PR_71();
    void PR_72();
    void PR_73();
    void PR_74();
    void PR_75();
    void PR_76();
    void PR_77();
    void PR_78();
    void PR_79();
    void PR_7A();
    void PR_7B();
    void PR_7C();
    void PR_7D();
    void PR_7E();
    void PR_7F();
    void PR_80();
    void PR_81();
    void PR_82();
    void PR_83();
    void PR_84();
    void PR_85();
    void PR_86();
    void PR_87();
    void PR_88();
    void PR_89();
    void PR_8A();
    void PR_8B();
    void PR_8C();
    void PR_8D();
    void PR_8E();
    void PR_8F();
    void PR_90();
    void PR_91();
    void PR_92();
    void PR_93();
    void PR_94();
    void PR_95();
    void PR_96();
    void PR_97();
    void PR_98();
    void PR_99();
    void PR_9A();
    void PR_9B();
    void PR_9C();
    void PR_9D();
    void PR_9E();
    void PR_9F();
    void PR_A0();
    void PR_A1();
    void PR_A2();
    void PR_A3();
    void PR_A4();
    void PR_A5();
    void PR_A6();
    void PR_A7();
    void PR_A8();
    void PR_A9();
    void PR_AA();
    void PR_AB();
    void PR_AC();
    void PR_AD();
    void PR_AE();
    void PR_AF();
    void PR_B0();
    void PR_B1();
    void PR_B2();
    void PR_B3();
    void PR_B4();
    void PR_B5();
    void PR_B6();
    void PR_B7();
    void PR_B8();
    void PR_B9();
    void PR_BA();
    void PR_BB();
    void PR_BC();
    void PR_BD();
    void PR_BE();
    void PR_BF();
    void PR_C0();
    void PR_C1();
    void PR_C2();
    void PR_C3();
    void PR_C4();
    void PR_C5();
    void PR_C6();
    void PR_C7();
    void PR_C8();
    void PR_C9();
    void PR_CA();
    void PR_CB();
    void PR_CC();
    void PR_CD();
    void PR_CE();
    void PR_CF();
    void PR_D0();
    void PR_D1();
    void PR_D2();
    void PR_D3();
    void PR_D4();
    void PR_D5();
    void PR_D6();
    void PR_D7();
    void PR_D8();
    void PR_D9();
    void PR_DA();
    void PR_DB();
    void PR_DC();
    void PR_DD();
    void PR_DE();
    void PR_DF();
    void PR_E0();
    void PR_E1();
    void PR_E2();
    void PR_E3();
    void PR_E4();
    void PR_E5();
    void PR_E6();
    void PR_E7();
    void PR_E8();
    void PR_E9();
    void PR_EA();
    void PR_EB();
    void PR_EC();
    void PR_ED();
    void PR_EE();
    void PR_EF();
    void PR_F0();
    void PR_F1();
    void PR_F2();
    void PR_F3();
    void PR_F4();
    void PR_F5();
    void PR_F6();
    void PR_F7();
    void PR_F8();
    void PR_F9();
    void PR_FA();
    void PR_FB();
    void PR_FC();
    void PR_FD();
    void PR_FE();
    void PR_FF(); 
};
